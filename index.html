<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIT - Offline Test</title>
    <style>
        .card { border: 1px solid #ccc; padding: 20px; margin: 20px; }
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            max-width: 100%;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="card">
        <h2>Faculty of Information Technology</h2>
        <p>Optimise your skills with us!</p>
        <div class="video-container">
            <iframe src="https://www.youtube.com/embed/dHshazPbKJs?autoplay=1&mute=1&loop=1&playlist=dHshazPbKJs" frameborder="0" allowfullscreen></iframe>
        </div>
    </div>

    <script>
        const serviceWorkerScript = `
            const CACHE_NAME = 'fit-test-cache-v1';
            const urlsToCache = ['/', '/index.html'];

            self.addEventListener('install', event => {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                        .then(cache => cache.addAll(urlsToCache))
                        .catch(err => console.log('Cache error:', err))
                );
            });

            self.addEventListener('fetch', event => {
                event.respondWith(
                    caches.match(event.request)
                        .then(response => response || fetch(event.request).catch(() => 
                            new Response('<h1>Offline</h1><p>You are offline.</p>', 
                                { headers: { 'Content-Type': 'text/html' } })
                        ))
                );
            });

            self.addEventListener('activate', event => {
                const cacheWhitelist = [CACHE_NAME];
                event.waitUntil(
                    caches.keys().then(cacheNames => 
                        Promise.all(
                            cacheNames.map(cacheName => 
                                !cacheWhitelist.includes(cacheName) ? caches.delete(cacheName) : null
                            ))
                        )
                );
            });
        `;

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const blob = new Blob([serviceWorkerScript], { type: 'application/javascript' });
                const workerUrl = URL.createObjectURL(blob);
                navigator.serviceWorker.register(workerUrl, { scope: '/' })
                    .then(reg => console.log('Service Worker registered:', reg))
                    .catch(err => console.log('Service Worker failed:', err));
            });
        }

        let wasOffline = false;
        window.addEventListener('offline', () => wasOffline = true);
        window.addEventListener('online', () => {
            if (wasOffline) window.location.reload();
        });
    </script>
</body>
</html>
